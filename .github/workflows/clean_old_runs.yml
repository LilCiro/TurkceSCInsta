name: TÃ¼m Ä°ÅŸ AkÄ±ÅŸÄ± GeÃ§miÅŸini Sil ğŸš¨ğŸ—‘ï¸

on:
  workflow_dispatch: # Bu iÅŸ akÄ±ÅŸÄ±nÄ± sadece manuel olarak tetiklemeye izin verir

jobs:
  delete_all:
    runs-on: ubuntu-latest # GitHub CLI Ubuntu runner'da yÃ¼klÃ¼ gelir
    permissions:
      contents: none
      actions: write # Ä°ÅŸ akÄ±ÅŸÄ± Ã§alÄ±ÅŸtÄ±rmalarÄ±nÄ± silebilmek iÃ§in bu izne ihtiyaÃ§ duyarÄ±z

    steps:
      - name: GitHub CLI YÃ¼klÃ¼ mÃ¼ Kontrol Et ve DoÄŸrula
        run: |
          gh --version
          echo "GITHUB_TOKEN'Ä± gh CLI iÃ§in yapÄ±landÄ±rÄ±lÄ±yor..."
          echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token
          gh auth status

      - name: TÃ¼m Eski Ä°ÅŸ AkÄ±ÅŸÄ± Ã‡alÄ±ÅŸtÄ±rmalarÄ±nÄ± Direkt Sil ğŸ”¥
        run: |
          echo "Depodaki tÃ¼m iÅŸ akÄ±ÅŸÄ± Ã§alÄ±ÅŸtÄ±rmalarÄ± listeleniyor ve siliniyor..."
          # TÃ¼m iÅŸ akÄ±ÅŸÄ± ID'lerini al ve her birini sil
          # Not: Bu komut, baÅŸarÄ±lÄ± olsa bile "yinelemeli olarak sil" gibi bir uyarÄ± verebilir.
          # '--repo "${{ github.repository }}"' mevcut depoyu belirtir
          # '--limit 1000' bir seferde en fazla 1000 Ã§alÄ±ÅŸtÄ±rmayÄ± listeler, ihtiyaca gÃ¶re artÄ±rÄ±labilir
          # '--json databaseId' her Ã§alÄ±ÅŸtÄ±rmanÄ±n ID'sini JSON formatÄ±nda alÄ±r
          # 'jq -r '.[].databaseId'' bu JSON'dan sadece ID'leri Ã§Ä±karÄ±r
          # 'xargs -I {} gh run delete {} --repo "${{ github.repository }}"' her ID iÃ§in silme komutunu Ã§alÄ±ÅŸtÄ±rÄ±r.
          
          gh run list --repo "${{ github.repository }}" --limit 1000 --json databaseId | jq -r '.[].databaseId' | xargs -I {} gh run delete {} --repo "${{ github.repository }}" --yes

          echo "Silme iÅŸlemi tamamlandÄ±. DeÄŸiÅŸikliklerin GitHub arayÃ¼zÃ¼nde yansÄ±masÄ± biraz zaman alabilir."
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} # gh CLI'Ä±n token'Ä± kullanmasÄ±nÄ± saÄŸlar
