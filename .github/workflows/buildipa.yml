# Bu iÅŸ akÄ±ÅŸÄ± aÅŸaÄŸÄ±daki iÅŸ akÄ±ÅŸlarÄ±ndan bÃ¼yÃ¼k Ã¶lÃ§Ã¼de esinlenilmiÅŸtir:
# https://github.com/arichornlover/uYouEnhanced/blob/main/.github/workflows/buildapp.yml
# https://github.com/ISnackable/YTCubePlus/blob/main/.github/workflows/Build.yml
# https://github.com/BandarHL/BHTwitter/actions/workflows/build.yml

name: TÃ¼rkÃ§e SCInsta'yÄ± Derle ve Paketle ğŸ“¦ğŸš€âœ¨ğŸ› ï¸

on:
  workflow_dispatch: # Bu iÅŸ akÄ±ÅŸÄ±nÄ± GitHub arayÃ¼zÃ¼nden manuel olarak tetiklemeye izin verir. ğŸŒğŸ‘†âš™ï¸
    inputs:
      decrypted_instagram_url: # Åifresi Ã§Ã¶zÃ¼lmÃ¼ÅŸ Instagram IPA'sÄ±nÄ±n doÄŸrudan URL'si. ğŸ”—ğŸ”ğŸ“±ğŸ“¥
        description: "Åifresi Ã§Ã¶zÃ¼lmÃ¼ÅŸ Instagram IPA'sÄ±nÄ±n doÄŸrudan URL'si (NasÄ±l yapacaÄŸÄ±nÄ±zÄ± bilmiyorsanÄ±z sss okuyun)"
        default: ""
        required: true
        type: string
      upload_artifact: # OluÅŸturulan paketi GitHub Artifacts'a yÃ¼kleyip yÃ¼klemeyeceÄŸi. ğŸ“¤ğŸ“‚âœ…â˜ï¸
        description: "Derleme sonucunu (artifact) yÃ¼kle"
        default: true
        required: false
        type: boolean
          
concurrency: # AynÄ± anda birden fazla Ã§alÄ±ÅŸtÄ±rmanÄ±n nasÄ±l yÃ¶netileceÄŸini belirler. ğŸš¦ğŸ”„â³ğŸš«
  group: ${{ github.workflow }}-${{ github.ref }} # AynÄ± iÅŸ akÄ±ÅŸÄ± ve referans iÃ§in yalnÄ±zca bir Ã§alÄ±ÅŸtÄ±rmaya izin verir.
  cancel-in-progress: true # Devam eden Ã§alÄ±ÅŸtÄ±rmalarÄ± iptal eder.

jobs:
  build: # Derleme iÅŸi. ğŸ—ï¸ğŸ’»ğŸğŸ“¦
    name: SCInsta'yÄ± Derle ğŸš€âœ¨âœ…ğŸ› ï¸
    runs-on: macos-latest # Ä°ÅŸin en son macOS sÃ¼rÃ¼mÃ¼nde Ã§alÄ±ÅŸacaÄŸÄ±nÄ± belirtir. ğŸğŸ’»
    permissions: # Ä°ÅŸin sahip olduÄŸu izinler. ğŸ”‘ğŸ”’
      contents: write # Depo iÃ§eriÄŸine yazma izni verir. âœï¸

    steps: # Ä°ÅŸin adÄ±mlarÄ±. ğŸ‘£â¡ï¸
      - name: Ana Depoyu Ã‡ek ğŸ“¥ğŸ“‚ğŸ”—ğŸ”„
        uses: actions/checkout@v4 # Depoyu Ã§ekmek iÃ§in checkout eylemini kullanÄ±r.
        with:
          path: main # Depoyu 'main' dizinine Ã§eker.
          submodules: recursive # Alt modÃ¼lleri de Ã¶zyinelemeli olarak Ã§eker.

      - name: BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle ğŸ“¦ğŸ”§âš™ï¸ğŸ“š
        run: brew install ldid dpkg make # Gerekli araÃ§larÄ± (ldid, dpkg, make) Homebrew ile yÃ¼kler.

      - name: PATH Ortam DeÄŸiÅŸkenini Ayarla ğŸ›£ï¸ğŸŒâš™ï¸â¡ï¸
        run: echo "$(brew --prefix make)/libexec/gnubin" >> $GITHUB_PATH # 'make' komutunun doÄŸru sÃ¼rÃ¼mÃ¼nÃ¼ PATH'e ekler.

      - name: Theos'u Kur ğŸğŸ› ï¸âš™ï¸ğŸš€
        uses: actions/checkout@v4 # Theos deposunu Ã§ekmek iÃ§in checkout eylemini kullanÄ±r.
        with:
          repository: theos/theos # Theos'un GitHub deposu.
          ref: master # Master branch'ini Ã§eker.
          path: ${{ github.workspace }}/theos # Theos'u Ã§alÄ±ÅŸma alanÄ±ndaki 'theos' dizinine Ã§eker.
          submodules: recursive # Theos'un alt modÃ¼llerini de Ã¶zyinelemeli olarak Ã§eker.
            
      - name: SDK Ã–nbellekleme ğŸ’¾âš¡ï¸ğŸ“¥ğŸ”„
        id: SDK # Bu adÄ±m iÃ§in bir ID belirler.
        uses: actions/cache@v4 # Ã–nbellekleme eylemini kullanÄ±r.
        env:
          cache-name: iPhoneOS14.5.sdk # Ã–nbellek adÄ±.
        with:
          path: ${{ github.workspace }}/theos/sdks/ # Ã–nbelleÄŸe alÄ±nacak dizin.
          key: ${{ env.cache-name }} # Ã–nbellek anahtarÄ±.
          restore-keys: ${{ env.cache-name }} # Geri yÃ¼klenecek anahtarlar.

      - name: iOS SDK Ä°ndir â¬‡ï¸ğŸ“±ğŸŒğŸ“¦
        if: steps.SDK.outputs.cache-hit != 'true' # EÄŸer SDK Ã¶nbellekte yoksa Ã§alÄ±ÅŸÄ±r.
        run: |
          git clone --quiet -n --depth=1 --filter=tree:0 https://github.com/xybp888/iOS-SDKs/ # iOS SDK'larÄ±nÄ± iÃ§eren depoyu klonlar.
          cd iOS-SDKs # Dizin deÄŸiÅŸtirir.
          git sparse-checkout set --no-cone iPhoneOS14.5.sdk # Sadece belirtilen SDK'yÄ± Ã§eker.
          git checkout # Ã‡ekilen SDK'yÄ± etkinleÅŸtirir.
          mv *.sdk $THEOS/sdks # SDK'yÄ± Theos'un SDK dizinine taÅŸÄ±r.
        env:
          THEOS: ${{ github.workspace }}/theos # THEOS ortam deÄŸiÅŸkenini ayarlar.

      - name: Instagram IPA'yÄ± HazÄ±rla ğŸ“±ğŸ“¦ğŸ”—ğŸ“¥
        run: |
          cd main # Ana depo dizinine gider.
          mkdir -p packages # 'packages' dizini oluÅŸturur.
          wget "$Instagram_URL" --no-verbose -O packages/com.burbn.instagram.ipa # Belirtilen URL'den Instagram IPA'sÄ±nÄ± indirir.
          ls -la packages # 'packages' dizininin iÃ§eriÄŸini listeler.
            
        env:
          THEOS: ${{ github.workspace }}/theos # THEOS ortam deÄŸiÅŸkenini ayarlar.
          Instagram_URL: ${{ inputs.decrypted_instagram_url }} # GiriÅŸlerden alÄ±nan Instagram URL'sini kullanÄ±r.

      - name: SCInsta SÃ¼rÃ¼mÃ¼nÃ¼ Al ğŸ·ï¸ğŸ”¢âœ¨ğŸ“„
        id: scinsta_version # Bu adÄ±m iÃ§in bir ID belirler.
        run: |
          SCINSTA_VERSION=$(awk '/Version:/ {print $2}' main/control) # 'main/control' dosyasÄ±ndan sÃ¼rÃ¼m bilgisini alÄ±r.
          echo "SCINSTA_VERSION=${SCINSTA_VERSION}" >> "$GITHUB_ENV" # SÃ¼rÃ¼mÃ¼ ortam deÄŸiÅŸkeni olarak ayarlar.
          echo "version=${SCINSTA_VERSION}" >> "$GITHUB_OUTPUT" # SÃ¼rÃ¼mÃ¼ Ã§Ä±ktÄ± olarak ayarlar.
            
      - name: SCInsta tweak'i sideload iÃ§in derle (IPA olarak) ğŸ—ï¸ğŸ“±ğŸš€ğŸ“¦
        run: |
          pip install --force-reinstall https://github.com/asdfzxcvbn/pyzule-rw/archive/main.zip # pyzule-rw paketini yÃ¼kler.
            
          cd main # Ana depo dizinine gider.
          ls -la # Dizin iÃ§eriÄŸini listeler.

          ./build.sh sideload # Derleme betiÄŸini sideload moduyla Ã§alÄ±ÅŸtÄ±rÄ±r.

          ls -la packages # 'packages' dizininin iÃ§eriÄŸini listeler.
            
        env:
          THEOS: ${{ github.workspace }}/theos # THEOS ortam deÄŸiÅŸkenini ayarlar.

      - name: IPA'yÄ± sÃ¼rÃ¼m bilgisiyle yeniden adlandÄ±r ğŸ·ï¸ğŸ”„ğŸ“¦âœ¨
        run: |
          cd main/packages # 'packages' dizinine gider.
          mv "$(ls -t | head -n1)" "SCInsta_sideloaded_v${SCINSTA_VERSION}.ipa" # En son oluÅŸturulan IPA dosyasÄ±nÄ± sÃ¼rÃ¼m bilgisiyle yeniden adlandÄ±rÄ±r.

      - name: Paket adÄ±nÄ± yÃ¼kleme eylemine ilet ğŸ“¤ğŸ“‚â¡ï¸ğŸ”—
        id: package_name # Bu adÄ±m iÃ§in bir ID belirler.
        run: |
          echo "package=$(ls -t main/packages | head -n1)" >> "$GITHUB_OUTPUT" # En son paketin adÄ±nÄ± Ã§Ä±ktÄ± olarak ayarlar.

      - name: Artifact YÃ¼kle â¬†ï¸ğŸ“¦â˜ï¸âœ…
        if: ${{ inputs.upload_artifact }} # EÄŸer 'upload_artifact' giriÅŸi doÄŸru ise Ã§alÄ±ÅŸÄ±r.
        uses: actions/upload-artifact@v4 # Artifact yÃ¼kleme eylemini kullanÄ±r.
        with:
          name: SCInsta_sideloaded_v${{ steps.scinsta_version.outputs.version }} # YÃ¼klenecek artifact'in adÄ±.
          path: ${{ github.workspace }}/main/packages/${{ steps.package_name.outputs.package }} # YÃ¼klenecek dosyanÄ±n yolu.
          if-no-files-found: error # Dosya bulunamazsa hata verir.
